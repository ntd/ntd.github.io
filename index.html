<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Miscellaneous stuff</title>
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
</head>

<body>

<nav class="navbar navbar-default" role="navigation">
<div class="container">

<div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#ss-navbar">
	<span class="sr-only">Toggle navigation</span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/">RT home</a>
</div>

<div class="collapse navbar-collapse" id="ss-navbar">
<ul class="nav navbar-nav navbar-right">
	<li class="link"><a href="https://github.com/ntd">GitHub</a></li>
	<li class="link"><a href="http://sourceforge.net/u/ntd/profile/">SourceForge</a></li>
	<li class="link"><a href="http://dev.entidi.com/">eNTiDi</a></li>
</ul>
</div>

</div>
</nav>

<div class="container">
<div class="page-header">
<h1>Random thoughts <small>Collection of unrelated material</small></h1>
</div>

<div class="row">

<div class="col-md-8">

<section class="clearfix" id="cycle-optimization">
<h2>Optimization of array cycles in Lua</h2>
<p><small>Sun, 07 Sep 2014 09:35:41 +0200</small></p>
<p>
A common pattern is to use Lua tables as arrays: there is no other data structure so
the choice is imposed. This does not usually pose any problem apart the fact you
cannot store <a href="http://lua-users.org/wiki/StoringNilsInTables"><code>nil</code>
values in tables</a> blindly.
</p>

<p>
However, when populating with millions of items, using Lua tables becomes a
performance issue because the length operator has <b>O(n)</b> complexity.
<code>table.insert</code>, the obvious candidate for such operation, has the worse
performance. Directly using <code>v[#v+1]</code> avoids a call but still suffers from
the O(n) problem. The proper solution is to avoid relying on the lengh operator by
keeping a separate pointer or directly use the iterator variable of the cycle.
</p>

<pre>
$ time lua -e 'a = {} for n = 1, 10000000 do table.insert(a, n) end'

real    0m3.218s
user    0m3.173s
sys 0m0.040s
$ time lua -e 'a = {} for n = 1, 10000000 do a[#a+1] = n end'

real    0m2.656s
user    0m2.623s
sys 0m0.027s
$ time lua -e 'a = {} for n = 1, 10000000 do a[n] = n end'

real    0m0.435s
user    0m0.403s
sys 0m0.027s
</pre>
</section>

<section class="clearfix" id="luarocks-debian">
<h2>luarocks 2.0.13 for Debian</h2>
<p><small>Wed, 18 Jun 2014 22:44:54 +0200</small></p>
<p>
Lately I am working quite intensively with the <a href="http://www.lua.org/">Lua</a>
programming language. I will have to deploy the final system on different linux
distros, mostly <a href="http://www.debian.org/">Debian</a> 7 (Wheezy) 64 bits, so I
decided to install it together with the Lua packages it depends on by leveraging the
natural deployment system provided by the Lua ecosystem, that is
<a href="http://www.luarocks.org/">LuaRocks</a>.
</p>
<p>
In short: the official LuaRocks package found in Debian repositories is 2.0.9 and it
has a bug that prevented me to use it successfully. I rebuilt and packaged LuaRocks
for Debian Wheezy using the latest compatible release (2.0.13) leaving almost all the
old settings but depending on Lua 5.2 instead of Lua 5.1. Hopefully it will be useful
to others.
</p>
<p>
<div class="pull-right">
<a class="btn btn-lg btn-success" href="assets/luarocks_2.0.13-1_all.deb"><span class="glyphicon glyphicon-download icon-white"></span> Download</a>
</div>
</p>
</section>

</div>

<div class="col-md-4">
<div class="hidden-print hidden-xs hidden-sm affix" role="complementary">
<ul class="nav">
    <li><a href="#cycle-optimization">Optimization of array cycles in Lua</a></li>
    <li><a href="#luarocks-debian">luarocks 2.0.13 for Debian</a></li>
</ul>
</div>
</div>

</div>

<footer class="row">
<hr>
<p>
Copyright Â© Fontana Nicola &mdash; Original information presented on this website,
unless otherwise indicated, should be considered in the public domain.
</p>
</footer>

</div>

</html>
